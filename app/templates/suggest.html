{% extends "base.html" %}
{% block title %}Suggestie - Vicaris Village{% endblock %}

{% block content %}

<div class="vv-suggest-page-bg">

    <div class="vv-suggest-wrapper">

        <h2 class="vv-suggest-title">ğŸµ Stel een artiest voor</h2>
        <p class="vv-suggest-subtitle">
            Kies jouw favoriete artiest uit de lijst hieronder en dien je suggestie in!
        </p>

        <!-- FORMULIER -->
        <form method="POST" onsubmit="return validateArtistInput()">

            <label for="artistInput" class="form-label fw-semibold mb-2">Kies artiest:</label>

            <!-- Custom dropdown -->
            <div class="vv-dropdown-wrapper">
                <input type="text" id="artistInput" name="artist_name" class="vv-dropdown-input"
                    placeholder="Typ of kies een artiest..." autocomplete="off" required>
                <div id="artistDropdown" class="vv-dropdown-list"></div>
            </div>

            <button type="submit" class="vv-suggest-btn mt-4">Verstuur suggestie</button>

        </form>

        {% if suggestions %}
        <div class="mt-4">
            <h5>Jouw voorgestelde artiesten:</h5>
            <ul>
                {% for s in suggestions %}
                <li>{{ s }}</li>
                {% endfor %}
            </ul>
            <p>Nog {{ remaining }} suggestie(s) over.</p>
        </div>
        {% endif %}

    </div>

</div>

<!-- JS onderaan, zodat de HTML al bestaat -->
<script>
    // ğŸ”¹ Lijst met artiesten vanuit Flask â†’ JSON
    const ARTISTS = {{ artists | map(attribute = 'Artist_name') | list | tojson }};

    const input = document.getElementById("artistInput");
    const dropdown = document.getElementById("artistDropdown");

    // Live search
    input.addEventListener("input", () => {
        const q = input.value.toLowerCase().trim();
        dropdown.innerHTML = "";

        if (q.length === 0) {
            dropdown.style.display = "none";
            return;
        }

        // Filter artiesten obv wat je typt
        const results = ARTISTS.filter(a => a.toLowerCase().includes(q));

        if (results.length === 0) {
            dropdown.style.display = "none";
            return;
        }

        results.forEach(artist => {
            const item = document.createElement("div");
            item.classList.add("vv-dropdown-item");
            item.textContent = artist;
            item.onclick = () => {
                input.value = artist;
                dropdown.style.display = "none";
            };
            dropdown.appendChild(item);
        });

        dropdown.style.display = "block";
    });

    // Klik buiten dropdown â†’ sluit
    document.addEventListener("click", (e) => {
        if (!input.contains(e.target) && !dropdown.contains(e.target)) {
            dropdown.style.display = "none";
        }
    });

    // Validatie vÃ³Ã³r submit
    function validateArtistInput() {
        const inputValue = input.value.trim().toLowerCase();
        const validValues = ARTISTS.map(a => a.toLowerCase());

        if (!validValues.includes(inputValue)) {
            alert("âš ï¸ Kies een artiest uit de lijst (je kan geen nieuwe artiest intypen).");
            input.focus();
            return false; // blokkeert het versturen
        }
        return true;
    }
</script>

{% endblock %}