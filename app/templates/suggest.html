{% extends "base.html" %}
{% block title %}Suggestie - Vicaris Village{% endblock %}

{% block content %}

<div class="vv-suggest-page-bg">
  <div class="vv-suggest-wrapper">

    <h2 class="vv-suggest-title">ðŸŽµ Stel een artiest voor</h2>
    <p class="vv-suggest-subtitle">
      Kies jouw favoriete artiest uit de lijst hieronder en dien je suggestie in
      voor de huidige editie!
    </p>

    <!-- FORMULIER -->
    <form method="POST" onsubmit="return validateArtistInput()">

      <label for="artistInput" class="form-label fw-semibold mb-2">Kies artiest:</label>

      <!-- Custom dropdown -->
      <div class="vv-dropdown-wrapper">
        <input
          type="text"
          id="artistInput"
          name="artist_name"
          class="vv-dropdown-input"
          placeholder="Typ of kies een artiest..."
          autocomplete="off"
          required
        >
        <div id="artistDropdown" class="vv-dropdown-list"></div>
        <div id="artistError" class="alert alert-warning mt-3 d-none" role="alert"></div>
      </div>

      <button type="submit" class="vv-suggest-btn mt-4">
        Verstuur suggestie
      </button>
    </form>

    <!-- OVERZICHT VAN JE SUGGESTIES IN DEZE EDITIE -->
    {% if suggestions %}
      <h3 class="mt-5 h5">Jouw voorgestelde artiesten (deze editie):</h3>
      <ul class="mt-2">
        {% for name in suggestions %}
          <li>{{ name }}</li>
        {% endfor %}
      </ul>
    {% endif %}

    <p class="mt-3">
      Nog <strong>{{ remaining }}</strong> suggestie(s) over voor deze editie.
    </p>

  </div>
</div>

<!-- JS onderaan, zodat de HTML al bestaat -->
<script>
  // Lijst met artiesten vanuit Flask â†’ JSON
  const ARTISTS = {{ artists | map(attribute='Artist_name') | list | tojson }};

  const input = document.getElementById("artistInput");
  const dropdown = document.getElementById("artistDropdown");
  const errorBox = document.getElementById("artistError");

  // Live search
  input.addEventListener("input", () => {
    const q = input.value.toLowerCase().trim();
    dropdown.innerHTML = "";
    errorBox.classList.add("d-none");
    errorBox.textContent = "";

    if (q.length === 0) {
      dropdown.style.display = "none";
      return;
    }

    // Filter artiesten obv wat je typt
    const results = ARTISTS.filter(a => a.toLowerCase().includes(q));

    if (results.length === 0) {
      dropdown.style.display = "none";
      return;
    }

    results.forEach(artist => {
      const item = document.createElement("div");
      item.classList.add("vv-dropdown-item");
      item.dataset.value = artist;
      item.textContent = artist;
      dropdown.appendChild(item);
    });

    dropdown.style.display = "block";
  });

  // Klik buiten dropdown â†’ sluit
  document.addEventListener("click", (e) => {
    if (!input.contains(e.target) && !dropdown.contains(e.target)) {
      dropdown.style.display = "none";
    }
  });

  dropdown.addEventListener("mousedown", (e) => {
    const item = e.target.closest(".vv-dropdown-item");
    if (!item) return;

    e.preventDefault();
    errorBox.classList.add("d-none");
    errorBox.textContent = "";
    input.value = item.dataset.value ?? "";
    dropdown.style.display = "none";
  });
  // Validatie vÃ³Ã³r submit: enkel artiest uit de lijst
  function validateArtistInput() {
    const inputValue = input.value.trim().toLowerCase();
    const validValues = ARTISTS.map(a => a.toLowerCase());

    if (!validValues.includes(inputValue)) {
      errorBox.textContent = "Kies een artiest uit de lijst (je kan geen nieuwe artiest intypen).";
      errorBox.classList.remove("d-none");
      input.focus();
      return false; // blokkeert het versturen
    }
    return true;
  }
</script>

{% endblock %}
